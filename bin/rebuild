#!/bin/bash
SCRIPT_DIR=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )
cd "$SCRIPT_DIR" || exit

docker compose down

sudo rm $SCRIPT_DIR/../nginx/ssl/*

# Generate a self-signed certificate and key in one command
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout $SCRIPT_DIR/../nginx/ssl/magento.key \
  -out $SCRIPT_DIR/../nginx/ssl/magento.crt \
  -subj "/C=CL/ST=RM/L=Santiago/O=TI/CN=qa.oteroindustrial.cl"

chmod 664 $SCRIPT_DIR/../nginx/ssl/*

docker compose up -d